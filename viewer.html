<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>迷路追蹤器 觀眾端 Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 如已存在 css/viewer.css 可保留；否則此連結可先留著 -->
  <link rel="stylesheet" href="/css/viewer.css" />

  <style>
    /* 基本樣式 -------------------------------------------------- */
    body{
      margin:0;
      padding:16px;
      font-family:system-ui,-apple-system,"PingFang TC","Microsoft JhengHei",sans-serif;
      background:#020617;
      color:#e5e7eb;
    }
    .viewer-page{
      max-width:1200px;
      margin:0 auto;
    }
    .viewer-header{
      margin-bottom:12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:10px;
      border-bottom:1px solid rgba(148,163,184,.5);
      padding-bottom:8px;
    }
    .viewer-title{
      margin:0;
      font-size:22px;
      letter-spacing:.12em;
    }
    .viewer-subtitle{
      margin:4px 0 0;
      font-size:13px;
      color:rgba(148,163,184,.9);
    }
    #viewerStatus{
      font-size:13px;
      color:#38bdf8;
      text-align:right;
      min-width:180px;
    }
    .viewer-main{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .game-info{
      display:flex;
      flex-wrap:wrap;
      gap:16px;
    }
    .info-block{
      flex:1 1 260px;
      min-width:220px;
      padding:10px 12px;
      border-radius:10px;
      background:rgba(15,23,42,.95);
      border:1px solid rgba(51,65,85,.9);
      box-shadow:0 8px 20px rgba(15,23,42,.9);
      font-size:14px;
    }
    .info-block h3{
      margin:0 0 6px;
      font-size:15px;
      letter-spacing:.08em;
      color:#e5e7eb;
    }
    .info-block div{
      margin:2px 0;
    }
    .goal-info{
      margin-top:8px;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #facc15;
      color:#facc15;
      font-weight:600;
      background:rgba(0,0,0,.4);
      font-size:14px;
    }

    .map-wrapper{
      position:relative; /* ★ 讓星星以地圖為定位基準 */
      padding:10px;
      border-radius:12px;
      background:radial-gradient(circle at top,#020617,#000);
      border:1px solid rgba(30,64,175,.8);
      box-shadow:0 12px 30px rgba(15,23,42,.95);
      overflow:auto;
    }
    #viewerMap{
      display:block;
      background:#020617;
    }

    /* 目的地大星星 ICON ----------------------------------------- */
    .goal-star {
      position:absolute;
      width:40px;
      height:40px;
      transform:translate(-50%, -50%);
      pointer-events:none;
      z-index:50;
      background:url('data:image/svg+xml;utf8,\
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">\
          <polygon points="32,4 39,24 60,24 42,38 48,58 32,46 16,58 22,38 4,24 25,24" \
            fill="%23facc15" stroke="%23fde047" stroke-width="4" />\
        </svg>') no-repeat center center / contain;
      filter:drop-shadow(0 0 6px rgba(250,204,21,.9))
             drop-shadow(0 0 12px rgba(250,204,21,.6));
      animation:starPulse 1.6s ease-in-out infinite;
    }
    @keyframes starPulse {
      0%   { transform:translate(-50%, -50%) scale(0.88); opacity:0.85; }
      50%  { transform:translate(-50%, -50%) scale(1.16); opacity:1; }
      100% { transform:translate(-50%, -50%) scale(0.88); opacity:0.85; }
    }

    @media (max-width:768px){
      body{padding:10px;}
      .viewer-header{flex-direction:column;align-items:flex-start;}
      #viewerStatus{text-align:left;}
    }
  </style>
</head>
<body>
  <div class="viewer-page">
    <header class="viewer-header">
      <div>
        <h1 class="viewer-title">迷路追蹤器 · 觀眾端</h1>
        <p class="viewer-subtitle">顯示兩位玩家在城市中的位置與方位資訊</p>
      </div>
      <div id="viewerStatus">載入中…</div>
    </header>

    <main class="viewer-main">
      <!-- 遊戲資訊區：玩家 A / B 四周 + 目的地 -->
      <section class="game-info">
        <div class="info-block">
          <h3>玩家 A 周邊</h3>
          <div id="infoAQuads">尚未有玩家資料</div>

          <!-- 目的地資訊：A 起始位置的東北格（固定，不隨 A 移動） -->
          <div id="goalInfo" class="goal-info">目的地：尚未設定</div>
        </div>

        <div class="info-block">
          <h3>玩家 B 周邊</h3>
          <div id="infoBQuads">尚未有玩家資料</div>
        </div>
      </section>

      <!-- 大地圖畫面：用 canvas 繪製 -->
      <section class="map-section">
        <div class="map-wrapper">
          <!-- 寬高由 viewer.js 根據地圖尺寸自動設定 -->
          <canvas id="viewerMap"></canvas>
        </div>
      </section>
    </main>
  </div>

  <!-- Supabase JS（CDN 版本） -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- Supabase 客戶端初始化：設定 window._supabase -->
  <script src="/js/supabaseClient.js"></script>

  <!-- 店舖名與地圖生成：提供 generateMap / isWall / getShopName -->
  <script src="/js/shopName.js"></script>

  <!-- 觀眾端邏輯：需使用你現在的 viewer.js（已修正交叉點座標與目的地） -->
  <script src="/js/viewer.js"></script>
</body>
</html>
